---
/**
 * screener.astro — Stock Screener Analysis Terminal
 * Advanced multi-vector entity selection and forensic filtering.
 */
import MainTerminal from '../layouts/MainTerminal.astro';
import ScreenerController from '../components/organisms/ScreenerController.svelte';
import ForensicTicker from '../components/molecules/ForensicTicker.astro';

try {
    const svc = await import('../utils/stockDataService');
    await svc.getStocksWithPrices();
} catch (e) {
    console.error('[Screener Engine] Initial load error:', e);
}

const { strategies: allStrategies } = await import('../data/strategies');
const supportedIds = [
    'low-pe',
    'low-pb',
    'high-dividend',
    'revenue-growth',
    'high-margin',
    'volume-breakout',
    'high-roe',
    'positive-fcf',
    'foreign-buy',
    'trust-buy',
];
const presetStrategies = allStrategies.filter(s => supportedIds.includes(s.id));
---

<MainTerminal title="選股中心">
    <div class="relative pb-20 pt-0 px-4 lg:px-6">
        <ScreenerController client:idle presetStrategies={presetStrategies} />

        <!-- Signal Stream -->
        <div
            class="flex items-center justify-between pt-4 px-4 bg-surface/5 rounded-xl border border-border/5 mb-6"
        >
            <ForensicTicker />
            <span class="text-[9px] font-mono text-text-muted/40 uppercase tracking-widest"
                >Database_Frame: LATEST_60D_SYNC</span
            >
        </div>
    </div>

    <!-- Client Script -->
    <script src="../scripts/screener-engine.ts"></script>
</MainTerminal>
