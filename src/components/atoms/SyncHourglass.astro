---
// src/components/atoms/SyncHourglass.astro
interface Props {
    class?: string;
    size?: 'large' | 'small';
}
const { class: className = '', size = 'small' } = Astro.props;

const containerSize = size === 'large' ? 'w-24 h-24' : 'w-8 h-8';
---

<div
    id="hourglass-container"
    class={`relative group hidden flex items-center justify-center shrink-0 ${containerSize} ${className}`}
>
    <!-- Background Glow -->
    <div
        class="absolute inset-0 bg-accent/5 blur-2xl rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-700"
    >
    </div>

    <svg
        class="w-full h-full drop-shadow-[0_0_8px_rgba(59,130,246,0.3)]"
        viewBox="0 0 100 100"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
    >
        <defs>
            <linearGradient id="sandGrad" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0%" stop-color="#3b82f6"></stop>
                <stop offset="100%" stop-color="#1d4ed8"></stop>
            </linearGradient>

            <clipPath id="upperVesselClip">
                <path d="M35 15 H65 L60 43 L50 48 L40 43 Z"></path>
            </clipPath>

            <clipPath id="lowerVesselClip">
                <path d="M35 85 H65 L60 57 L50 52 L40 57 Z"></path>
            </clipPath>
        </defs>

        <g id="main-hourglass" class="origin-center hg-animate-sync">
            <!-- Glass Frame -->
            <path
                d="M35 15 H65 L60 45 L50 50 L40 45 Z M35 85 H65 L60 55 L50 50 L40 55 Z"
                stroke="currentColor"
                stroke-width="1"
                class="text-accent/20"
                fill="rgba(59,130,246,0.02)"></path>

            <!-- Tech Caps -->
            <path d="M30 10 H70 V15 H30 Z" fill="currentColor" class="text-accent"></path>
            <path d="M30 85 H70 V90 H30 Z" fill="currentColor" class="text-accent"></path>

            <!-- Upper Sand (Drains from Top to Mid) -->
            <g clip-path="url(#upperVesselClip)">
                <rect class="sand-rect-upper" x="30" width="40" fill="url(#sandGrad)"></rect>
            </g>

            <!-- Lower Sand (Fills from Bottom to Mid) -->
            <g clip-path="url(#lowerVesselClip)">
                <rect class="sand-rect-lower" x="30" width="40" fill="url(#sandGrad)"></rect>
            </g>

            <!-- Stream -->
            <g class="stream-group">
                <line
                    x1="50"
                    y1="48"
                    x2="50"
                    y2="82"
                    stroke="currentColor"
                    stroke-width="1"
                    class="text-accent/50 hg-stream-line"></line>
                <circle cx="50" cy="48" r="0.8" fill="white" class="hg-particle"></circle>
            </g>

            <!-- Glow Core -->
            <circle cx="50" cy="50" r="3" fill="currentColor" class="text-accent animate-pulse"
            ></circle>
        </g>
    </svg>
</div>

<style>
    /* CSS Animations for perfect sync with the container's flip */
    .hg-animate-sync .sand-rect-upper {
        animation: hg-drain 15s linear infinite;
    }
    .hg-animate-sync .sand-rect-lower {
        animation: hg-fill 15s linear infinite;
    }
    .hg-animate-sync .hg-stream-line {
        stroke-dasharray: 2 4;
        animation: hg-stream 0.3s linear infinite;
    }
    .hg-animate-sync .hg-particle {
        animation: hg-fall 0.6s linear infinite;
    }

    @keyframes hg-drain {
        0% {
            height: 35px;
            y: 15px;
            opacity: 1;
        }
        95%,
        100% {
            height: 0px;
            y: 48px;
            opacity: 0.2;
        }
    }

    @keyframes hg-fill {
        0% {
            height: 0px;
            y: 85px;
            opacity: 0.2;
        }
        95%,
        100% {
            height: 35px;
            y: 52px;
            opacity: 1;
        }
    }

    @keyframes hg-stream {
        to {
            stroke-dashoffset: 20;
        }
    }

    @keyframes hg-fall {
        0% {
            cy: 48px;
            opacity: 1;
        }
        100% {
            cy: 82px;
            opacity: 0;
        }
    }
</style>
