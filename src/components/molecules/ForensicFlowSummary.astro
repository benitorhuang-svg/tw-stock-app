---
/**
 * ForensicFlowSummary.astro - High-level summary of institutional flow
 */

interface Props {
    institutionalAlpha: string;
    recentTotalNet: number;
}

const { institutionalAlpha, recentTotalNet } = Astro.props;

const fmtNet = (n: number) => {
    if (n === 0) return '—';
    const prefix = n > 0 ? '+' : '';
    return `${prefix}${n.toLocaleString('zh-TW')}`;
};

const alphaLabel = institutionalAlpha.replace('_', ' ');
const alphaColorClass =
    institutionalAlpha === 'BULLISH_FLOW'
        ? 'text-bullish'
        : institutionalAlpha === 'DISTRIBUTION'
          ? 'text-bearish'
          : 'text-text-muted';
---

<div
    class="glass-card p-4 flex items-center justify-between border-l-4 border-accent bg-accent/[0.02] animate-fade-up"
>
    <div class="flex items-center gap-4">
        <div
            class="w-10 h-10 rounded-full bg-accent/20 flex items-center justify-center text-accent"
        >
            <svg
                xmlns="http://www.w3.org/2000/svg"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
            >
                <path d="M2 20h20"></path>
                <path d="m7 10 2 2 2-2 2 2 2-2 2 2 2-2"></path>
                <path d="M20 12V4a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v10"></path>
            </svg>
        </div>
        <div>
            <h3 class="text-xs font-mono font-bold text-white/40 uppercase tracking-widest">
                Forensic Flow Analysis
            </h3>
            <div class="flex items-center gap-2 mt-0.5">
                <span class:list={['text-sm font-bold', alphaColorClass]}>
                    {alphaLabel}
                </span>
                <span
                    class="text-[10px] text-text-muted px-1.5 py-0.5 rounded bg-white/5 font-mono"
                >
                    CONFIDENCE: HIGHER
                </span>
            </div>
        </div>
    </div>
    <div class="flex gap-8 px-6 border-l border-white/5">
        <div>
            <div class="text-[9px] text-text-muted uppercase mb-1">5D Net Flow</div>
            <div
                class:list={[
                    'font-mono text-sm font-bold',
                    recentTotalNet >= 0 ? 'text-bullish' : 'text-bearish',
                ]}
            >
                {fmtNet(recentTotalNet)}
                <span class="text-[10px] font-normal opacity-40">張</span>
            </div>
        </div>
        <div>
            <div class="text-[9px] text-text-muted uppercase mb-1">Big Money Bias</div>
            <div class="font-mono text-sm font-bold text-accent">ACCUMULATING</div>
        </div>
    </div>
</div>
