---
/**
 * ForensicTicker.astro - Real-time market signal ticker
 */
---

<div class="flex items-center gap-3">
    <div class="w-2 h-2 rounded-full bg-accent animate-pulse"></div>
    <span class="text-[10px] font-mono text-text-muted uppercase tracking-widest"
        >Forensic Signal Stream</span
    >
    <div class="h-[1px] w-20 bg-surface-hover/50"></div>
    <p class="text-[10px] text-text-muted/50 italic font-medium" id="momentum-ticker">
        Waiting for scan initialization...
    </p>
</div>

<script>
    let forensicTickerInterval: number | null = null;
    let isForensicTickerRendered = false;

    function startTicker() {
        const ticker = document.getElementById('momentum-ticker');
        if (!ticker) return;

        if (forensicTickerInterval) clearInterval(forensicTickerInterval);

        const messages = [
            'Detecting institutional footprints in SEMICON sector...',
            'Analyzing momentum divergence across growth vectors...',
            'Forensic scan complete. High-conviction signals isolated.',
            'Institutional capital inflow detected in top deciles.',
            'Scanning for technical breakouts in low P/E domains...',
        ];
        let i = 0;
        forensicTickerInterval = window.setInterval(() => {
            if (!document.getElementById('momentum-ticker')) return;
            ticker.style.opacity = '0';
            setTimeout(() => {
                if (!document.getElementById('momentum-ticker')) return;
                ticker.textContent = messages[i];
                ticker.style.opacity = '1';
                i = (i + 1) % messages.length;
            }, 500);
        }, 4000);
    }

    document.addEventListener('astro:before-preparation', () => {
        if (forensicTickerInterval) {
            clearInterval(forensicTickerInterval);
            forensicTickerInterval = null;
        }
    });

    document.addEventListener('astro:page-load', () => {
        if (!document.getElementById('momentum-ticker')) {
            isForensicTickerRendered = false;
            if (forensicTickerInterval) {
                clearInterval(forensicTickerInterval);
                forensicTickerInterval = null;
            }
            return;
        }
        if (isForensicTickerRendered) return;
        isForensicTickerRendered = true;
        startTicker();
    });
</script>

<style>
    #momentum-ticker {
        transition: opacity 0.5s ease-in-out;
    }
</style>
