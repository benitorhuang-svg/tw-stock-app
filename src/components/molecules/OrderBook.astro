---
/**
 * OrderBook.astro
 */
interface Props {
    price: number;
    change: number;
    isBullish: boolean;
    isBearish: boolean;
    priceColor: string;
    askPrices: number[];
    askVolumes: number[];
    bidPrices: number[];
    bidVolumes: number[];
    maxBookVol: number;
}
const {
    price,
    change,
    isBullish,
    isBearish,
    priceColor,
    askPrices,
    askVolumes,
    bidPrices,
    bidVolumes,
    maxBookVol,
} = Astro.props;
---

<!-- Order Book -->
<div class="glass-card p-4">
    <h3 class="terminal-label mb-3">五檔報價</h3>
    <!-- Asks (sell side) - reversed -->
    <div class="space-y-0.5 mb-2">
        {
            askPrices
                .slice()
                .reverse()
                .map((p, i) => {
                    const vol = askVolumes[4 - i];
                    const pct = (vol / maxBookVol) * 100;
                    return (
                        <div class="relative flex items-center justify-between px-2 py-1 rounded text-xs font-mono">
                            <div
                                class="absolute inset-y-0 right-0 bg-bearish/10 rounded"
                                style={`width: ${pct}%`}
                            />
                            <span class="relative text-bearish">{p.toFixed(2)}</span>
                            <span class="relative text-text-muted">{vol}</span>
                        </div>
                    );
                })
        }
    </div>
    <!-- Current price divider -->
    <div class="flex items-center gap-2 py-1.5 px-2 my-1 bg-surface-hover/30 rounded">
        <span class:list={['font-mono font-bold text-sm', priceColor]}>
            {price > 0 ? price.toFixed(2) : '—'}
        </span>
        <span class:list={['text-[10px] font-mono', priceColor]}>
            {isBullish ? '▲' : isBearish ? '▼' : '—'}{
                change !== 0 ? Math.abs(change).toFixed(2) : ''
            }
        </span>
    </div>
    <!-- Bids (buy side) -->
    <div class="space-y-0.5 mt-2">
        {
            bidPrices.map((p, i) => {
                const vol = bidVolumes[i];
                const pct = (vol / maxBookVol) * 100;
                return (
                    <div class="relative flex items-center justify-between px-2 py-1 rounded text-xs font-mono">
                        <div
                            class="absolute inset-y-0 right-0 bg-bullish/10 rounded"
                            style={`width: ${pct}%`}
                        />
                        <span class="relative text-bullish">{p.toFixed(2)}</span>
                        <span class="relative text-text-muted">{vol}</span>
                    </div>
                );
            })
        }
    </div>
</div>
