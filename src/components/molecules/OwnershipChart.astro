---
/**
 * OwnershipChart.astro
 * Visualizes big money concentration and shareholder structure
 */
interface Props {
    bigMoneyRatio: number;
    retailRatio: number;
    trendData: number[]; // Last N months/weeks
}

const { bigMoneyRatio, retailRatio, trendData } = Astro.props;
---

<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <!-- Big Money Trend Bar Chart -->
    <div class="glass-card p-5 glow-interactive">
        <h3 class="terminal-label mb-3">大戶持股比率趨勢</h3>
        <div class="h-[120px] flex items-end justify-around gap-1 px-2">
            {
                trendData.map((v, i) => (
                    <div class="flex flex-col items-center gap-1 flex-1">
                        <div
                            class="w-full rounded-t-sm bg-accent/40 hover:bg-accent/60 transition-colors"
                            style={`height: ${v}%`}
                        />
                        {i % 3 === 0 && (
                            <span class="text-[7px] font-mono text-text-muted">
                                {trendData.length - i}月前
                            </span>
                        )}
                    </div>
                ))
            }
        </div>
        <div class="flex items-center justify-between mt-3 text-xs text-text-muted font-mono">
            <span>400張以上大戶</span>
            <span class="text-bullish font-bold">{bigMoneyRatio.toFixed(1)}%</span>
        </div>
    </div>

    <!-- Structure Donut Chart -->
    <div class="glass-card p-5 glow-interactive">
        <h3 class="terminal-label mb-3">股東結構分佈</h3>
        <div class="flex items-center justify-center h-[120px] gap-6">
            <svg viewBox="0 0 100 100" class="w-24 h-24">
                <circle
                    cx="50"
                    cy="50"
                    r="40"
                    fill="none"
                    stroke="hsl(217,91%,60%,0.3)"
                    stroke-width="12"></circle>
                <circle
                    cx="50"
                    cy="50"
                    r="40"
                    fill="none"
                    stroke="hsl(217,91%,60%,0.8)"
                    stroke-width="12"
                    stroke-dasharray={`${(bigMoneyRatio / 100) * 251.3} ${251.3}`}
                    stroke-dashoffset="0"
                    transform="rotate(-90 50 50)"
                    stroke-linecap="round"></circle>
                <text
                    x="50"
                    y="48"
                    text-anchor="middle"
                    fill="white"
                    font-size="14"
                    font-weight="bold"
                    font-family="var(--font-mono)">{Math.round(bigMoneyRatio)}%</text
                >
                <text x="50" y="62" text-anchor="middle" fill="hsl(240,4%,40%)" font-size="8"
                    >大戶</text
                >
            </svg>
            <div class="space-y-2 text-xs">
                <div class="flex items-center gap-2">
                    <span class="w-2.5 h-2.5 rounded-full bg-accent"></span>
                    <span class="text-text-secondary"
                        >千張大股東 <span class="font-mono text-accent font-bold"
                            >{bigMoneyRatio.toFixed(0)}%</span
                        ></span
                    >
                </div>
                <div class="flex items-center gap-2">
                    <span class="w-2.5 h-2.5 rounded-full bg-accent/30"></span>
                    <span class="text-text-secondary"
                        >50張以下散戶 <span class="font-mono text-text-muted font-bold"
                            >{retailRatio.toFixed(0)}%</span
                        ></span
                    >
                </div>
            </div>
        </div>
    </div>
</div>
