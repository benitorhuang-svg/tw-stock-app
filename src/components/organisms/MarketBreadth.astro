---
/**
 * MarketBreadth.astro — Market breadth visualization bar
 * Shows advancing vs declining stocks with proportional bar and labels.
 */
interface Props {
    up: number;
    down: number;
    flat: number;
    total: number;
    class?: string;
}

const { up, down, flat, total, class: className = '' } = Astro.props;

const pctUp = total > 0 ? (up / total) * 100 : 0;
const pctDown = total > 0 ? (down / total) * 100 : 0;
const pctFlat = total > 0 ? (flat / total) * 100 : 0;
const ratio = down > 0 ? (up / down).toFixed(2) : '∞';
---

<div class:list={['market-breadth', className]}>
    <!-- Summary Row -->
    <div class="flex items-center justify-between mb-3">
        <div class="flex items-center gap-4">
            <div class="flex items-center gap-1.5">
                <span class="w-2 h-2 rounded-full bg-bullish"></span>
                <span class="text-xs font-semibold text-bullish">{up}</span>
                <span class="text-[10px] text-text-muted">上漲</span>
            </div>
            <div class="flex items-center gap-1.5">
                <span class="w-2 h-2 rounded-full bg-text-muted/40"></span>
                <span class="text-xs font-semibold text-text-secondary">{flat}</span>
                <span class="text-[10px] text-text-muted">平盤</span>
            </div>
            <div class="flex items-center gap-1.5">
                <span class="w-2 h-2 rounded-full bg-bearish"></span>
                <span class="text-xs font-semibold text-bearish">{down}</span>
                <span class="text-[10px] text-text-muted">下跌</span>
            </div>
        </div>
        <div class="text-right">
            <span class="text-[10px] text-text-muted">漲跌比</span>
            <span class="text-xs font-mono font-bold text-text-primary ml-1">{ratio}</span>
        </div>
    </div>

    <!-- Breadth Bar -->
    <div class="w-full h-2.5 rounded-full bg-surface overflow-hidden flex gap-px">
        <div
            class="h-full bg-gradient-to-r from-bullish to-bullish/70 rounded-l-full transition-all duration-700 ease-out"
            style={`width: ${pctUp}%`}
        ></div>
        <div
            class="h-full bg-text-muted/20 transition-all duration-700 ease-out"
            style={`width: ${pctFlat}%`}
        ></div>
        <div
            class="h-full bg-gradient-to-r from-bearish/70 to-bearish rounded-r-full transition-all duration-700 ease-out"
            style={`width: ${pctDown}%`}
        ></div>
    </div>

    <!-- Percentage Labels -->
    <div class="flex justify-between mt-1.5 text-[10px] font-mono text-text-muted">
        <span>{pctUp.toFixed(1)}%</span>
        <span>{pctFlat.toFixed(1)}%</span>
        <span>{pctDown.toFixed(1)}%</span>
    </div>
</div>
