---
/**
 * MarketBreadth.astro — Market breadth visualization bar
 * Shows advancing vs declining stocks with proportional bar and labels.
 */
interface Props {
    up: number;
    down: number;
    flat: number;
    total: number;
    class?: string;
}

const { up, down, flat, total, class: className = '' } = Astro.props;

const pctUp = total > 0 ? (up / total) * 100 : 0;
const pctDown = total > 0 ? (down / total) * 100 : 0;
const pctFlat = total > 0 ? (flat / total) * 100 : 0;
---

<div class:list={['market-breadth flex flex-col gap-1', className]}>
    <div class="flex justify-between items-center px-1 h-3.5 relative overflow-hidden">
        <!-- Left: Down Count -->
        <div class="flex items-center gap-1.5 shrink-0">
            <span class="text-[8px] font-black text-bearish/60 uppercase">D</span>
            <span
                class="text-[10px] font-mono font-bold text-bearish leading-none"
                id="breadth-down">{down}</span
            >
        </div>

        <!-- Center: Ratio -->
        <div class="flex items-center gap-1 text-accent/50">
            <span class="text-[7px] font-black uppercase tracking-tighter">RATIO</span>
            <span
                class="text-[10px] font-mono font-black text-accent leading-none"
                id="breadth-ratio"
            >
                {down > 0 ? (up / down).toFixed(2) : '∞'}
            </span>
        </div>

        <!-- Right: Up Count -->
        <div class="flex items-center gap-1.5 shrink-0">
            <span class="text-[10px] font-mono font-bold text-bullish leading-none" id="breadth-up"
                >{up}</span
            >
            <span class="text-[8px] font-black text-bullish/60 uppercase">U</span>
        </div>

        <!-- Hidden but present for JS updates -->
        <span id="breadth-flat" class="hidden">{flat}</span>
    </div>

    <div
        class="w-full h-1.5 rounded-full bg-base-deep/80 border border-white/5 overflow-hidden flex relative shadow-inner"
    >
        <!-- Declining Bar -->
        <div
            id="breadth-bar-down"
            class="h-full bg-bearish shadow-[0_0_10px_rgba(34,197,94,0.3)] transition-all duration-1000 ease-[cubic-bezier(0.34,1.56,0.64,1)] relative z-10"
            style={`width: ${pctDown}%`}
        >
        </div>

        <!-- Flat Bar -->
        <div
            id="breadth-bar-flat"
            class="h-full bg-text-muted/10 transition-all duration-1000 ease-[cubic-bezier(0.34,1.56,0.64,1)]"
            style={`width: ${pctFlat}%`}
        >
        </div>

        <!-- Advancing Bar -->
        <div
            id="breadth-bar-up"
            class="h-full bg-bullish shadow-[0_0_10px_rgba(239,68,68,0.3)] transition-all duration-1000 ease-[cubic-bezier(0.34,1.56,0.64,1)] relative z-10"
            style={`width: ${pctUp}%`}
        >
        </div>

        <!-- Center Divider Glow -->
        <div
            class="absolute left-1/2 top-0 bottom-0 w-px bg-white/20 z-20 shadow-[0_0_4px_rgba(255,255,255,0.4)]"
        >
        </div>
    </div>
</div>
