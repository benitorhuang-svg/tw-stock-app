---
/**
 * DatabaseRefreshArea.astro - Inline data synchronization UI
 */
---

<div id="refresh-area" class="hidden flex-1 flex-col relative w-full h-full bg-base">
    <div class="absolute inset-0 bg-glow-radial opacity-10 pointer-events-none"></div>

    <div class="flex-1 flex flex-col p-6 max-w-5xl mx-auto w-full gap-6">
        <!-- Unified Dashboard Panel (Compact Row) -->
        <div
            class="bg-surface/50 border border-border/50 rounded-xl relative z-10 backdrop-blur-md px-5 py-4 flex flex-col lg:flex-row items-center gap-6 lg:gap-8"
        >
            <!-- Start Action -->
            <button
                id="start-refresh-btn"
                class="btn-cyber shrink-0 py-2.5 px-5 text-[12px] font-bold tracking-[0.2em] transform hover:scale-105 transition-all shadow-[0_0_15px_rgba(var(--accent-rgb),0.2)] hover:shadow-[0_0_25px_rgba(var(--accent-rgb),0.4)] flex items-center gap-2 rounded-lg"
            >
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"
                    ></path>
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                åŸ·è¡Œæ›´æ–°
            </button>

            <!-- Graphical Stage Progress -->
            <div class="flex-1 w-full relative lg:px-4">
                <div class="flex justify-between relative">
                    <!-- Connecting Line -->
                    <div
                        class="absolute top-[20px] left-0 w-full h-[2px] bg-white/5 -translate-y-1/2 z-0"
                    >
                    </div>
                    <div
                        id="stage-progress-line"
                        class="absolute top-[20px] left-0 w-0 h-[2px] bg-accent shadow-[0_0_15px_rgba(var(--accent-rgb),0.6)] -translate-y-1/2 z-0 transition-all duration-700"
                    >
                    </div>

                    <!-- Stages -->
                    {
                        [
                            { step: 1, label: 'æ¸…å–®æ›´æ–°', icon: 'ðŸ“‹' },
                            { step: 2, label: 'æ•¸æ“šèˆ‡é‘‘è­˜åŒæ­¥', icon: 'ðŸ”' },
                            { step: 3, label: 'å¿«ç…§å»ºç½®', icon: 'ðŸ“¸' },
                            { step: 4, label: 'ç´¢å¼•å„ªåŒ–', icon: 'âš¡' },
                            { step: 5, label: 'åŒæ­¥å®Œæˆ', icon: 'âœ…' },
                        ].map(s => (
                            <div
                                class="flex flex-col items-center gap-2 relative z-10 stage-item"
                                data-step={s.step}
                                id={`stage-step-${s.step}`}
                            >
                                <div class="w-10 h-10 rounded-full bg-surface border border-border/50 flex items-center justify-center text-[1rem] transition-all duration-500 stage-icon grayscale opacity-40 shadow-inner">
                                    {s.icon}
                                </div>
                                <div class="flex flex-col items-center gap-0.5">
                                    <span class="text-[9px] font-mono text-white/30 font-bold uppercase tracking-widest hidden md:block">
                                        Step {s.step}
                                    </span>
                                    <span class="text-[11px] font-black text-white/40 transition-colors stage-label tracking-wide whitespace-nowrap">
                                        {s.label}
                                    </span>
                                </div>
                            </div>
                        ))
                    }
                </div>
            </div>

            <!-- ETA -->
            <div
                id="refresh-eta-container"
                class="shrink-0 flex items-center gap-2 opacity-0 transition-opacity duration-500 translate-x-3 no-display group bg-accent/10 py-1.5 px-3 rounded-lg border border-accent/20"
            >
                <span
                    class="text-[10px] font-mono font-bold text-accent/80 tracking-widest uppercase"
                >
                    ETA:
                </span>
                <span
                    id="refresh-eta"
                    class="text-sm font-mono font-black text-accent shadow-[0_0_10px_rgba(var(--accent-rgb),0.2)]"
                >
                    --:--
                </span>
            </div>
        </div>

        <!-- Terminal Content -->
        <div
            class="flex-1 min-h-[300px] relative rounded-xl overflow-hidden border border-border/50 bg-black/60 shadow-inner"
        >
            <div
                class="absolute top-0 left-0 right-0 h-8 bg-surface/80 border-b border-border/50 flex items-center px-4 backdrop-blur-sm"
            >
                <div class="flex gap-2">
                    <div class="w-3 h-3 rounded-full bg-red-500/20 border border-red-500/40"></div>
                    <div class="w-3 h-3 rounded-full bg-yellow-500/20 border border-yellow-500/40">
                    </div>
                    <div class="w-3 h-3 rounded-full bg-accent/20 border border-accent/40"></div>
                </div>
            </div>
            <div
                id="refresh-terminal"
                class="absolute inset-0 top-8 overflow-y-auto text-xs text-accent/80 font-mono leading-relaxed custom-scrollbar whitespace-pre-wrap p-6"
            >
                >> ç­‰å¾…æŒ‡ä»¤...
            </div>
        </div>
    </div>
</div>

<script src="../../scripts/database-refresh-engine.ts"></script>
