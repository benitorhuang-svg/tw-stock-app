---
/**
 * TabBar.astro â€” 5 analysis tabs for individual stock pages
 * Maps to spec 002~007: Overview, Database, Technical, Chips, Fundamentals, Alerts
 */
interface Props {
    symbol: string;
    activeTab?: string;
}

const { symbol, activeTab = 'overview' } = Astro.props;

const tabs = [
    { id: 'overview', label: 'ç¸½è¦½', icon: 'ğŸ“Š' },
    { id: 'technical', label: 'æŠ€è¡“é¢', icon: 'ğŸ“ˆ' },
    { id: 'chips', label: 'ç±Œç¢¼é¢', icon: 'ğŸ¦' },
    { id: 'fundamentals', label: 'åŸºæœ¬é¢', icon: 'ğŸ’°' },
    { id: 'alerts', label: 'AI å ±å‘Š', icon: 'ğŸ¤–' },
];
---

<nav
    class="flex items-center gap-1 px-2 py-1 glass-panel rounded-xl mb-6"
    id="stock-tab-bar"
    aria-label="åˆ†æåˆ†é "
>
    {
        tabs.map(tab => (
            <button
                class:list={[
                    'flex items-center gap-2 px-4 py-2.5 rounded-lg text-sm font-semibold transition-all duration-200 cursor-pointer',
                    activeTab === tab.id
                        ? 'bg-accent/15 text-accent shadow-[inset_0_1px_0_hsl(0_0%_100%/0.1)]'
                        : 'text-text-secondary hover:text-text-primary hover:bg-glass-hover',
                ]}
                data-tab={tab.id}
                data-symbol={symbol}
                aria-selected={activeTab === tab.id}
                role="tab"
            >
                <span class="text-sm">{tab.icon}</span>
                <span class="hidden sm:inline">{tab.label}</span>
            </button>
        ))
    }
</nav>

<script>
    document.querySelectorAll('#stock-tab-bar [data-tab]').forEach(btn => {
        btn.addEventListener('click', () => {
            const tabId = (btn as HTMLElement).dataset.tab;
            const symbol = (btn as HTMLElement).dataset.symbol;

            // Update active state
            document.querySelectorAll('#stock-tab-bar [data-tab]').forEach(b => {
                b.classList.remove('bg-accent/15', 'text-accent');
                b.classList.add('text-text-secondary');
                b.setAttribute('aria-selected', 'false');
            });
            btn.classList.add('bg-accent/15', 'text-accent');
            btn.classList.remove('text-text-secondary');
            btn.setAttribute('aria-selected', 'true');

            // Show/hide tab content panels
            document.querySelectorAll('[data-tab-content]').forEach(panel => {
                const panelId = (panel as HTMLElement).dataset.tabContent;
                if (panelId === tabId) {
                    panel.classList.remove('hidden');
                    (panel as HTMLElement).style.animation =
                        'fade-up 0.4s cubic-bezier(0.16, 1, 0.3, 1) both';
                } else {
                    panel.classList.add('hidden');
                }
            });

            console.log(`[TabBar] Switch to: ${tabId} for ${symbol}`);
        });
    });
</script>
