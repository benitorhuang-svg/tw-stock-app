---
/**
 * RefreshTerminal.astro - Global refresh data handler and UI
 */
---

<!-- Refresh Terminal Overlay (Global) -->
<div
    id="refresh-overlay"
    class="hidden fixed inset-0 bg-base-deep/95 backdrop-blur-xl z-[100] flex-col flex items-center justify-center p-6"
>
    <div
        class="w-full max-w-3xl bg-surface border border-border/50 rounded-2xl shadow-[0_0_80px_rgba(0,0,0,0.8)] overflow-hidden flex flex-col relative"
    >
        <div class="absolute inset-0 bg-glow-radial opacity-10 pointer-events-none"></div>

        <!-- Terminal Header -->
        <div
            class="bg-base-deep px-5 py-3 border-b border-border/50 flex items-center justify-between relative z-10"
        >
            <div class="flex items-center gap-3">
                <div class="flex gap-1.5">
                    <div class="w-3 h-3 rounded-full bg-red-500/20 border border-red-500/40"></div>
                    <div class="w-3 h-3 rounded-full bg-yellow-500/20 border border-yellow-500/40">
                    </div>
                    <div class="w-3 h-3 rounded-full bg-accent/20 border border-accent/40"></div>
                </div>
                <span
                    class="text-[10px] font-mono font-black text-text-muted tracking-[0.2em] flex items-center gap-2"
                >
                    CORE_DATA_SYNCHRONIZER_V2
                </span>
                <div
                    id="refresh-eta-container"
                    class="flex items-center gap-1.5 ml-4 opacity-0 transition-opacity duration-500 translate-x-3 no-display group"
                >
                    <span
                        class="text-[9px] font-mono font-bold text-accent/80 tracking-widest uppercase"
                        >Estimated Completion:</span
                    >
                    <span
                        id="refresh-eta"
                        class="text-[10px] font-mono font-black text-accent bg-accent/10 border border-accent/20 px-2 py-0.5 rounded shadow-[0_0_10px_rgba(var(--accent-rgb),0.2)]"
                        >--:--</span
                    >
                </div>
            </div>
            <button
                id="close-refresh"
                class="hidden hover:bg-red-500/20 text-text-muted hover:text-red-400 px-3 py-1 rounded-lg transition-colors text-[10px] font-black border border-border/50 hover:border-red-500/30"
                >âœ• é—œé–‰è¦–çª—</button
            >
        </div>

        <!-- Graphical Stage Progress -->
        <div class="p-6 bg-base mt-2 relative z-10">
            <div class="flex justify-between relative">
                <!-- Connecting Line -->
                <div class="absolute top-1/2 left-0 w-full h-[2px] bg-white/5 -translate-y-1/2 z-0">
                </div>
                <div
                    id="stage-progress-line"
                    class="absolute top-1/2 left-0 w-0 h-[2px] bg-accent shadow-[0_0_10px_rgba(var(--accent-rgb),0.5)] -translate-y-1/2 z-0 transition-all duration-700"
                >
                </div>

                <!-- Stages -->
                {
                    [
                        { step: 1, label: 'æ¸…å–®æ›´æ–°', icon: 'ðŸ“‹' },
                        { step: 2, label: 'æ•¸æ“šåŒæ­¥', icon: 'ðŸ”„' },
                        { step: 3, label: 'å¿«ç…§å»ºç½®', icon: 'ðŸ“¸' },
                        { step: 4, label: 'ç´¢å¼•å„ªåŒ–', icon: 'âš¡' },
                        { step: 5, label: 'åŒæ­¥å®Œæˆ', icon: 'âœ…' },
                    ].map(s => (
                        <div
                            class="flex flex-col items-center gap-3 relative z-10 stage-item"
                            data-step={s.step}
                            id={`stage-step-${s.step}`}
                        >
                            <div class="w-10 h-10 rounded-xl bg-surface border border-border/50 flex items-center justify-center text-lg transition-all duration-500 stage-icon grayscale opacity-40 shadow-inner">
                                {s.icon}
                            </div>
                            <div class="flex flex-col items-center">
                                <span class="text-[9px] font-mono text-white/20 font-bold uppercase tracking-tighter">
                                    Step {s.step}
                                </span>
                                <span class="text-[11px] font-black text-white/30 transition-colors stage-label">
                                    {s.label}
                                </span>
                            </div>
                        </div>
                    ))
                }
            </div>
        </div>

        <!-- Terminal Content -->
        <div class="p-4 bg-black/60 relative z-10">
            <div
                id="refresh-terminal"
                class="h-64 overflow-y-auto text-[11px] text-accent/80 font-mono leading-relaxed custom-scrollbar whitespace-pre-wrap p-4 border border-white/5 rounded-lg bg-black/40 shadow-inner"
            >
            </div>
        </div>
    </div>
</div>

<script src="../../scripts/refresh-engine.ts"></script>
