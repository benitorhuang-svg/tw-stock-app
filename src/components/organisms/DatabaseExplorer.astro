---
/**
 * DatabaseExplorer.astro - Main data grid and toolbar
 */
import SearchInput from '../atoms/SearchInput.astro';
import PaginationControls from '../molecules/PaginationControls.astro';
import PageLimitSelect from '../atoms/PageLimitSelect.astro';
import SyncScrollbar from '../molecules/SyncScrollbar.astro';
import DatabaseWelcome from './DatabaseWelcome.astro';
---

<main class="flex-1 min-w-0 flex flex-col bg-base relative">
    <div
        class="absolute inset-0 opacity-[0.02] pointer-events-none bg-[linear-gradient(rgba(255,255,255,0.1)_1px,transparent_1px),linear-gradient(90deg,rgba(255,255,255,0.1)_1px,transparent_1px)] bg-[size:32px_32px]"
    >
    </div>

    <!-- Loading Indicator -->
    <div
        id="db-loading-bar"
        class="absolute top-0 left-0 h-[2px] bg-accent z-50 transition-all duration-300 shadow-[0_0_10px_#3b82f6]"
        style="width:0; opacity:0;"
    >
    </div>

    <!-- Toolbar -->
    <header
        id="explorer-toolbar"
        class="h-20 px-8 border-b border-border bg-base/95 backdrop-blur-3xl flex items-center gap-3 sticky top-0 z-40 shadow-elevated hidden opacity-0 transition-all duration-500 overflow-x-auto custom-scrollbar flex-shrink-0"
    >
        <!-- Search Segment -->
        <div class="flex-shrink-0 w-64 lg:w-80">
            <SearchInput id="global-search" placeholder="在全域資料中檢索..." class="w-full" />
        </div>

        <div class="w-px h-6 bg-border flex-shrink-0 hidden md:block"></div>

        <!-- Pagination & Limit -->
        <div
            id="table-controls"
            class="flex items-center gap-3 hidden opacity-0 transition-opacity duration-300 flex-shrink-0"
        >
            <PaginationControls prevId="prev-page" nextId="next-page" pageNumId="page-num" />
            <PageLimitSelect id="page-limit" />
        </div>
    </header>

    <!-- Table Container -->
    <div class="flex-1 min-h-0 overflow-hidden flex flex-col relative bg-base" id="grid-container">
        <!-- Welcome State -->
        <DatabaseWelcome />

        <!-- Error State -->
        <div
            id="db-error"
            class="hidden absolute inset-0 flex flex-col items-center justify-center text-center p-12 bg-red-950/20"
        >
            <span class="text-4xl mb-4">⚠️</span>
            <h3 class="text-red-500 font-bold uppercase tracking-widest text-sm">資料庫錯誤</h3>
            <p id="error-message" class="text-xs text-red-400/80 mt-2 font-mono"></p>
            <button
                onclick="location.reload()"
                class="px-6 py-2 rounded-xl bg-red-500/20 text-red-500 border border-red-500/30 font-bold text-xs mt-6"
                >重試</button
            >
        </div>

        <!-- Data Table Area -->
        <div class="flex-1 p-6 min-h-0 min-w-0 flex flex-col relative">
            <!-- Top Horizontal Scrollbar -->
            <SyncScrollbar
                id="top-scrollbar"
                contentId="top-scroll-content"
                class="hidden mb-1 rounded-t-xl opacity-80 hover:opacity-100 transition-opacity cursor-pointer"
            />

            <div
                id="table-scroll-container"
                class="rounded-2xl border border-border/50 flex-1 overflow-auto shadow-elevated bg-surface/30 custom-scrollbar relative"
            >
                <table
                    class="w-full text-left border-collapse hidden whitespace-nowrap min-w-full"
                    id="data-table"
                >
                    <thead
                        class="bg-surface border-b border-border/50 sticky top-0 z-10"
                        id="table-head"></thead>
                    <tbody class="divide-y divide-border/30" id="table-body"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer
        class="h-9 border-t border-border px-6 flex items-center justify-between bg-base-deep/80 relative z-20"
    >
        <div class="flex items-center gap-6">
            <p
                class="text-[10px] tracking-[0.1em] text-text-muted font-mono flex items-center gap-2 uppercase"
            >
                <svg
                    class="w-3 h-3 text-accent"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                >
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                </svg>
                Latency: <span
                    id="query-time"
                    class="text-accent font-black drop-shadow-[0_0_5px_rgba(59,130,246,0.5)]"
                    >0ms</span
                >
            </p>
        </div>
        <div
            class="flex items-center gap-6 text-[9px] tracking-[0.2em] font-mono font-black text-text-muted uppercase"
        >
            <span>ENGINE: BETTER-SQLITE3</span>
            <span class="flex items-center gap-1.5"
                ><div class="w-1 h-1 bg-text-muted/40 rounded-full animate-ping"></div> TICK: <span
                    id="tick-count"
                    class="text-text-secondary">0</span
                ></span
            >
        </div>
    </footer>
</main>
