---
import ScreenerSidebar from './ScreenerSidebar.astro';
import ScreenerResultHeader from '../molecules/ScreenerResultHeader.astro';
import ScreenerResultTable from '../molecules/ScreenerResultTable.astro';
import type { Strategy, StrategyCategory } from '../../types/stock';

let strategies: Strategy[] = [];
try {
    const { strategies: s } = await import('../../data/strategies');
    strategies = s?.slice(0, 12) ?? [];
} catch {
    strategies = [
        {
            id: 'low-pe',
            name: 'ä½æœ¬ç›Šæ¯”',
            description: 'æœ¬ç›Šæ¯”ä½æ–¼ 15 ä¸¦æ’é™¤è™§æå…¬å¸',
            icon: 'ğŸ’°',
            category: 'fundamental',
            conditions: [],
        },
        {
            id: 'high-dividend',
            name: 'é«˜è‚¡æ¯æ®–åˆ©ç‡',
            description: 'æ®–åˆ©ç‡é«˜æ–¼ 5%',
            icon: 'ğŸ’µ',
            category: 'fundamental',
            conditions: [],
        },
        {
            id: 'volume-breakout',
            name: 'é‡åƒ¹é½Šæš',
            description: 'æˆäº¤é‡æ”¾å¤§ + ç«™ä¸Šå‡ç·š',
            icon: 'ğŸš€',
            category: 'technical',
            conditions: [],
        },
        {
            id: 'foreign-buy',
            name: 'å¤–è³‡é€£è²·',
            description: 'æœ€æ–°å¤–è³‡è²·è¶…ç‚ºæ­£',
            icon: 'ğŸŒ',
            category: 'sentiment',
            conditions: [],
        },
    ];
}

const categoryLabel: Record<StrategyCategory, string> = {
    fundamental: 'åŸºæœ¬é¢',
    technical: 'æŠ€è¡“é¢',
    sentiment: 'ç±Œç¢¼é¢',
    momentum: 'å‹•èƒ½é¢',
    custom: 'è‡ªå®šç¾©',
};
---

<section
    id="screener-panel"
    class="grid grid-cols-1 xl:grid-cols-12 gap-4 min-h-[calc(100dvh-210px)]"
>
    <ScreenerSidebar strategies={strategies} categoryLabel={categoryLabel} />

    <main class="xl:col-span-8 glass-card p-0 overflow-hidden flex flex-col">
        <ScreenerResultHeader />

        <div id="screener-empty" class="flex-1 grid place-items-center p-8">
            <div class="text-center max-w-md">
                <div class="text-4xl mb-4">ğŸ”</div>
                <h3 class="text-lg font-bold text-text-primary mb-2">é¸æ“‡ä¸€å€‹ç­–ç•¥é–‹å§‹ç¯©é¸</h3>
                <p class="text-sm text-text-secondary">
                    é»æ“Šå·¦å´ç­–ç•¥å¾Œï¼Œç³»çµ±æœƒä»¥ SQLite
                    æ¢ä»¶æŸ¥è©¢å›å‚³ç¬¦åˆæ¨™çš„ï¼Œçµæœç¶­æŒé«˜å¯†åº¦çµ‚ç«¯è¡¨æ ¼æ ¼å¼ã€‚
                </p>
            </div>
        </div>

        <ScreenerResultTable />
    </main>
</section>

<script src="../../scripts/stock-screener-engine.ts"></script>
