---
// ProTopHeader.astro
const currentPath = Astro.url.pathname;
// A placeholder time, to be updated dynamically client-side
const lastUpdatedDate = new Date().toLocaleString('zh-TW', {
    hour12: false,
});
---

<header class="pro-top-header">
    <!-- Left: Global Search Component -->
    <div class="search-section">
        <form class="global-search-form" id="global-search-form" action="javascript:void(0);">
            <div class="search-input-wrapper">
                <span class="search-icon">üîç</span>
                <input
                    type="text"
                    id="global-search-input"
                    class="search-input"
                    placeholder="Ëº∏ÂÖ•ËÇ°Á•®‰ª£Ëôü (‰æã: 2330)..."
                    autocomplete="off"
                />
                <div class="shortcut-hint">
                    <kbd>Ctrl</kbd>+<kbd>K</kbd>
                </div>
            </div>
            <button type="submit" class="fetch-btn">ÂèñÂæóË≥áÊñô</button>
        </form>
    </div>

    <!-- Right: Status & Utilities -->
    <div class="utils-section">
        <!-- Settings -->
        <button class="icon-btn" aria-label="Settings" title="Á≥ªÁµ±Ë®≠ÂÆö">
            <span class="icon">‚öôÔ∏è</span>
        </button>

        <!-- Last Updated -->
        <div class="timestamp-badge">
            <span class="pulse-dot"></span>
            <span class="label">ÊúÄÂæåÊõ¥Êñ∞ÊôÇÈñì</span>
            <span class="time mono" id="last-updated-time">2026/02/22 21:14:04</span>
        </div>

        <!-- Theme Toggle -->
        <button
            class="icon-btn theme-toggle"
            id="theme-toggle"
            aria-label="Toggle Theme"
            title="Ê∑±Ëâ≤/‰∫ÆËâ≤ÂàáÊèõ"
        >
            <span class="icon light-icon" style="display:none;">‚òÄÔ∏è</span>
            <span class="icon dark-icon">üåô</span>
        </button>

        <!-- Notification Bell -->
        <button class="icon-btn notification-btn" aria-label="Notifications" title="ÈÄöÁü•">
            <span class="icon">üîî</span>
            <span class="badge">3</span>
        </button>

        <!-- Mobile Hamburger (Hidden on Desktop) -->
        <button class="mobile-menu-btn icon-btn" id="header-mobile-menu">
            <span class="icon">‚ò∞</span>
        </button>
    </div>
</header>

<style>
    .pro-top-header {
        height: 72px;
        width: 100%;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 24px;

        /* Premium Glassmorphism */
        background: var(--c-bg-glass);
        backdrop-filter: var(--glass-blur);
        -webkit-backdrop-filter: var(--glass-blur);
        border-bottom: 1px solid var(--c-border);

        position: sticky;
        top: 0;
        z-index: 30;
    }

    /* Left: Search Bar */
    .search-section {
        flex: 1;
        max-width: 500px;
    }

    .global-search-form {
        display: flex;
        align-items: center;
        gap: 8px;
        background: rgba(0, 0, 0, 0.2);
        border: 1px solid var(--c-border);
        border-radius: 20px;
        padding: 4px;
        padding-left: 16px;
        transition: all 0.3s var(--ease-out);
    }
    .global-search-form:focus-within {
        border-color: var(--c-accent);
        box-shadow: 0 0 12px rgba(var(--c-accent-rgb), 0.3);
        background: rgba(0, 0, 0, 0.4);
    }

    .search-input-wrapper {
        display: flex;
        align-items: center;
        flex: 1;
        gap: 12px;
    }

    .search-icon {
        font-size: 14px;
        opacity: 0.6;
    }

    .search-input {
        background: transparent;
        border: none;
        outline: none;
        color: var(--c-text-primary);
        font-size: 14px;
        flex: 1;
        font-family: 'Inter', sans-serif;
    }

    .search-input::placeholder {
        color: var(--c-text-muted);
    }

    .shortcut-hint {
        display: flex;
        gap: 4px;
        opacity: 0.7;
    }

    .shortcut-hint kbd {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 4px;
        padding: 2px 6px;
        font-size: 10px;
        font-family: inherit;
        border: 1px solid rgba(255, 255, 255, 0.05);
    }

    .fetch-btn {
        background: var(--c-accent);
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 16px;
        font-size: 13px;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.2s;
        white-space: nowrap;
    }

    .fetch-btn:hover {
        background: #2563eb;
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(var(--c-accent-rgb), 0.4);
    }

    /* Right: Utilities */
    .utils-section {
        display: flex;
        align-items: center;
        gap: 16px;
    }

    .timestamp-badge {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 6px 16px;
        border-radius: 20px;
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.05);
        border-right: 1px solid rgba(255, 255, 255, 0.1); /* Separator feel */
    }

    .pulse-dot {
        width: 8px;
        height: 8px;
        background: var(--c-success);
        border-radius: 50%;
        box-shadow: 0 0 8px var(--c-success);
        animation: pulse 2s infinite;
    }

    .timestamp-badge .label {
        font-size: 12px;
        color: var(--c-text-muted);
    }

    .timestamp-badge .time {
        font-size: 14px;
        font-weight: 700;
        color: var(--c-text-primary);
    }

    .icon-btn {
        width: 40px;
        height: 40px;
        border-radius: 12px;
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid var(--c-border);
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--c-text-primary);
        transition: all 0.2s;
        position: relative;
    }

    .icon-btn:hover {
        background: rgba(255, 255, 255, 0.1);
        transform: translateY(-2px);
    }

    .icon-btn.notification-btn .badge {
        position: absolute;
        top: -4px;
        right: -4px;
        background: var(--c-danger);
        color: white;
        font-size: 10px;
        font-weight: 800;
        min-width: 18px;
        height: 18px;
        border-radius: 9px;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 2px solid var(--c-bg-app);
    }

    .mobile-menu-btn {
        display: none;
    }

    @keyframes pulse {
        0% {
            opacity: 0.6;
            box-shadow: 0 0 4px var(--c-success);
        }
        50% {
            opacity: 1;
            box-shadow: 0 0 12px var(--c-success);
        }
        100% {
            opacity: 0.6;
            box-shadow: 0 0 4px var(--c-success);
        }
    }

    /* Responsive */
    @media (max-width: 1024px) {
        .pro-top-header {
            padding: 0 16px;
            gap: 16px;
        }
        .timestamp-badge .label {
            display: none;
        }
        .search-section {
            max-width: none;
        }
    }

    @media (max-width: 768px) {
        .mobile-menu-btn {
            display: flex;
        }
        .timestamp-badge {
            display: none;
        }
        .search-input-wrapper .shortcut-hint {
            display: none; /* Hide shortcut hint on mobile */
        }
    }
</style>

<script>
    // Theme Toggle Logic
    const themeBtn = document.getElementById('theme-toggle');
    const root = document.documentElement;

    themeBtn?.addEventListener('click', () => {
        const isDark = root.getAttribute('data-theme') !== 'light';
        if (isDark) {
            root.setAttribute('data-theme', 'light');
            localStorage.setItem('tw-stock-theme', 'light');
        } else {
            root.removeAttribute('data-theme');
            localStorage.setItem('tw-stock-theme', 'dark');
        }
    });

    // Ctrl+K Shortcut for Global Search focus
    document.addEventListener('keydown', e => {
        if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
            e.preventDefault();
            document.getElementById('global-search-input')?.focus();
        }
    });

    // Live Clock Update
    function updateClock() {
        const timeEl = document.getElementById('last-updated-time');
        if (timeEl) {
            const now = new Date();
            const yyyy = now.getFullYear();
            const mm = String(now.getMonth() + 1).padStart(2, '0');
            const dd = String(now.getDate()).padStart(2, '0');
            const HH = String(now.getHours()).padStart(2, '0');
            const MM = String(now.getMinutes()).padStart(2, '0');
            const SS = String(now.getSeconds()).padStart(2, '0');
            timeEl.textContent = `${yyyy}/${mm}/${dd} ${HH}:${MM}:${SS}`;
        }
    }

    // Update every second
    setInterval(updateClock, 1000);
    // Initial call
    updateClock();
</script>
