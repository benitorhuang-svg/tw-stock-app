---
/**
 * StockCard.astro — Compact stock info card with price & change
 * Used in grids like volume leaders, high yield, etc.
 */
interface Props {
    symbol: string;
    name: string;
    price: number;
    changePercent: number;
    volume?: number;
    pe?: number;
    yield_?: number;
    class?: string;
}

const {
    symbol,
    name,
    price,
    changePercent,
    volume = 0,
    pe = 0,
    yield_: yieldVal = 0,
    class: className = '',
} = Astro.props;

const bull = changePercent > 0;
const bear = changePercent < 0;

const fmtVol = (v: number) => {
    if (v >= 10000) return `${(v / 10000).toFixed(1)}萬`;
    if (v > 0) return v.toLocaleString('zh-TW');
    return '—';
};
const fmtPct = (v: number) => (v > 0 ? `+${v.toFixed(2)}%` : `${v.toFixed(2)}%`);
const fmtPrice = (v: number) => (v > 0 ? v.toFixed(2) : '—');
---

<a
    href={`/stocks/${symbol}`}
    class:list={[
        'stock-card glass-card glow-interactive block p-4 no-underline hover:scale-[1.02] transition-all group relative overflow-hidden',
        className,
    ]}
    data-astro-prefetch
>
    <!-- Top accent line -->
    <div class:list={[
        'absolute top-0 left-0 right-0 h-[2px]',
        bull && 'bg-gradient-to-r from-transparent via-bullish/50 to-transparent',
        bear && 'bg-gradient-to-r from-transparent via-bearish/50 to-transparent',
        !bull && !bear && 'bg-gradient-to-r from-transparent via-accent/20 to-transparent',
    ]}></div>

    <!-- Header: Name + Change Badge -->
    <div class="flex items-start justify-between mb-2">
        <div class="min-w-0">
            <div class="text-sm font-bold text-text-primary group-hover:text-accent transition-colors truncate">
                {name}
            </div>
            <div class="text-[11px] font-mono text-text-muted">{symbol}</div>
        </div>
        <span class:list={[
            'text-[11px] font-mono font-bold px-1.5 py-0.5 rounded shrink-0 ml-2',
            bull && 'bg-bullish/10 text-bullish',
            bear && 'bg-bearish/10 text-bearish',
            !bull && !bear && 'bg-surface text-text-muted',
        ]}>
            {fmtPct(changePercent)}
        </span>
    </div>

    <!-- Price -->
    <div class="data-value text-xl mb-1">{fmtPrice(price)}</div>

    <!-- Footer Meta -->
    <div class="flex items-center justify-between text-[11px] text-text-muted font-mono">
        <span>量 {fmtVol(volume)}</span>
        {pe > 0 && <span>PE {pe.toFixed(1)}</span>}
        {yieldVal > 0 && <span class="text-warning">{yieldVal.toFixed(1)}%</span>}
    </div>
</a>
