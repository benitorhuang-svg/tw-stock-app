---
/**
 * StockCard.astro — Individual stock info card
 * Used in stock listings, screener results, watchlists.
 */
interface Props {
    symbol: string;
    name: string;
    price?: number;
    change?: number;
    changePercent?: number;
    volume?: string;
    pe?: number;
    class?: string;
}

const {
    symbol,
    name,
    price,
    change = 0,
    changePercent = 0,
    volume,
    pe,
    class: className = '',
} = Astro.props;

const isPositive = change > 0;
const isNegative = change < 0;
---

<a
    href={`/stocks/${symbol}`}
    class:list={[
        'glass-card glow-interactive block p-4 transition-all duration-300 hover:scale-[1.02] hover:shadow-elevated group no-underline',
        className,
    ]}
    data-astro-prefetch
>
    <!-- Top: Name & Symbol -->
    <div class="flex items-start justify-between mb-3">
        <div>
            <h3
                class="text-base font-bold text-text-primary group-hover:text-accent transition-colors"
            >
                {name}
            </h3>
            <span class="font-mono text-xs text-text-muted">{symbol}</span>
        </div>
        {
            pe !== undefined && (
                <span class="terminal-label px-2 py-0.5 rounded bg-surface">
                    PE {pe?.toFixed(1) ?? '—'}
                </span>
            )
        }
    </div>

    <!-- Middle: Price -->
    <div class="flex items-baseline gap-2 mb-2">
        <span class="data-value text-2xl">
            {price?.toFixed(2) ?? '—'}
        </span>
        <span
            class:list={[
                'data-value text-sm',
                isPositive && 'text-bullish',
                isNegative && 'text-bearish',
                !isPositive && !isNegative && 'text-text-muted',
            ]}
        >
            {isPositive ? '▲' : isNegative ? '▼' : '—'}
            {changePercent !== 0 ? `${Math.abs(changePercent).toFixed(2)}%` : ''}
        </span>
    </div>

    <!-- Bottom: Volume -->
    {
        volume && (
            <div class="flex items-center justify-between pt-2 border-t border-border/50">
                <span class="terminal-label">成交量</span>
                <span class="text-xs font-mono text-text-secondary">{volume} 張</span>
            </div>
        )
    }

    <!-- Accent top border glow -->
    <div
        class:list={[
            'absolute top-0 left-0 right-0 h-[2px]',
            isPositive && 'bg-gradient-to-r from-transparent via-bullish/60 to-transparent',
            isNegative && 'bg-gradient-to-r from-transparent via-bearish/60 to-transparent',
            !isPositive &&
                !isNegative &&
                'bg-gradient-to-r from-transparent via-accent/30 to-transparent',
        ]}
    >
    </div>
</a>
