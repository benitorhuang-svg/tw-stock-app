---
/**
 * MoversPanel.astro — Top movers (gainers/losers) panel
 * Shows a ranked list of stocks with change indicators.
 */
import { fmtVol, fmtPct, fmtPrice } from '../../utils/format';

interface Props {
    title: string;
    stocks: Array<{
        symbol: string;
        name: string;
        price: number;
        changePercent: number;
        volume: number;
    }>;
    variant?: 'bullish' | 'bearish';
    class?: string;
}

const { title, stocks, variant = 'bullish', class: className = '' } = Astro.props;
const isBull = variant === 'bullish';
const accentColor = isBull ? 'bullish' : 'bearish';
---

<section class:list={['glass-card overflow-hidden', className]}>
    <!-- Header -->
    <div
        class:list={[
            'flex items-center justify-between px-4 py-2 border-b border-border',
            isBull ? 'bg-bullish/[0.03]' : 'bg-bearish/[0.03]',
        ]}
    >
        <h2
            class:list={[
                'text-sm font-bold tracking-wide flex items-center gap-2',
                `text-${accentColor}`,
            ]}
        >
            <span class:list={['w-1.5 h-1.5 rounded-full', `bg-${accentColor}`]}></span>
            {title}
        </h2>
        <span class="text-[11px] text-text-muted font-mono">{stocks.length} 檔</span>
    </div>

    <!-- Stock Rows -->
    <div class="divide-y divide-border/30">
        {
            stocks.map((s, i) => (
                <a
                    href={`/stocks/${s.symbol}`}
                    class="flex items-center justify-between px-4 py-1.5 hover:bg-glass-hover transition-colors group no-underline"
                    data-astro-prefetch
                >
                    <div class="flex items-center gap-2">
                        <span class="text-[10px] font-mono text-text-muted w-4 text-left">
                            {i + 1}
                        </span>
                        <div>
                            <div class="flex items-center gap-1.5">
                                <span
                                    class:list={[
                                        'text-sm font-semibold transition-colors text-stock-name',
                                    ]}
                                >
                                    {s.name}
                                </span>
                                <span class="text-[11px] font-mono text-stock-symbol">
                                    {s.symbol}
                                </span>
                            </div>
                            <span class="text-[10px] font-mono text-stock-volume">
                                量 {fmtVol(s.volume)}
                            </span>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="data-value text-sm text-stock-price">{fmtPrice(s.price)}</div>
                        <span class:list={['text-xs font-mono font-bold', `text-${accentColor}`]}>
                            {fmtPct(s.changePercent)}
                        </span>
                    </div>
                </a>
            ))
        }
        {
            stocks.length === 0 && (
                <div class="px-5 py-8 text-center text-sm text-text-muted">暫無資料</div>
            )
        }
    </div>
</section>
