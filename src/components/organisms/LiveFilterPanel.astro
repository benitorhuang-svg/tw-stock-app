---
// src/components/organisms/LiveFilterPanel.astro
---

<div class="flex items-center gap-1.5 shrink-0">
    <!-- Search Section -->
    <div class="relative group/search">
        <div
            class="absolute inset-y-0 left-3 flex items-center pointer-events-none text-text-muted/30 group-focus-within/search:text-accent transition-colors"
        >
            <svg
                class="w-3.5 h-3.5"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="3"
                stroke-linecap="round"
                stroke-linejoin="round"
            >
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.3-4.3"></path>
            </svg>
        </div>
        <input
            type="text"
            id="live-search-input"
            placeholder="代號/名稱..."
            class="w-[100px] h-8 pl-9 pr-2 bg-glass border border-border focus:border-accent/30 focus:bg-glass-hover rounded-full text-[10px] font-bold placeholder:text-text-muted/50 transition-all outline-none"
        />
    </div>

    <!-- Filter Group -->
    <div class="flex items-center gap-1 px-1 py-0.5 bg-glass rounded-full border border-border">
        <select
            id="filter-market"
            class="appearance-none h-7 px-2 bg-transparent text-[10px] font-black tracking-tighter text-text-primary/60 cursor-pointer outline-none hover:text-accent transition-all uppercase min-w-[50px]"
        >
            <option value="">全部</option>
            <option value="tse">上市</option>
            <option value="otc">上櫃</option>
        </select>
        <div class="w-[1px] h-3 bg-border shrink-0"></div>
        <select
            id="filter-sector"
            class="appearance-none h-7 px-2 bg-transparent text-[10px] font-black tracking-tighter text-text-primary/60 cursor-pointer outline-none hover:text-accent transition-all uppercase min-w-[65px]"
        >
            <option value="">產業</option>
            <option value="semiconductor">半導體</option>
            <option value="electronics">電子</option>
            <option value="computer">電腦</option>
            <option value="finance">金融</option>
            <option value="shipping">航運</option>
            <option value="etf">ETF</option>
        </select>
        <div class="w-[1px] h-3 bg-border shrink-0"></div>
        <select
            id="filter-price"
            class="appearance-none h-7 px-2 bg-transparent text-[10px] font-black tracking-tighter text-text-primary/60 cursor-pointer outline-none hover:text-accent transition-all uppercase min-w-[60px]"
        >
            <option value="">價格</option>
            <option value="0-50">50以下</option>
            <option value="50-100">50-100</option>
            <option value="100-500">100-500</option>
            <option value="500-10000">500以上</option>
        </select>
    </div>

    <!-- Pct Slider with +/- -->
    <div
        class="flex items-center gap-1.5 px-2 h-8 bg-glass rounded-full border border-border min-w-[150px]"
    >
        <div class="flex flex-col items-center justify-center shrink-0 w-7">
            <span
                id="trend-display"
                class="text-[9px] font-mono font-black text-accent leading-none">0%</span
            >
            <span
                class="text-[6px] text-text-muted/40 font-black tracking-widest leading-none mt-0.5 uppercase"
                >Pct</span
            >
        </div>
        <button
            id="trend-dn"
            class="text-text-muted/40 hover:text-accent transition-colors text-xs font-bold px-1"
            >－</button
        >
        <input
            type="range"
            id="filter-trend"
            min="-10"
            max="10"
            step="0.5"
            value="0"
            class="w-12 lg:w-16 h-1 bg-glass-elevated rounded-full appearance-none cursor-pointer accent-accent"
        />
        <button
            id="trend-up"
            class="text-text-muted/40 hover:text-accent transition-colors text-xs font-bold px-1"
            >＋</button
        >
    </div>

    <!-- Volume Slider with +/- -->
    <div
        class="flex items-center gap-1.5 px-2 h-8 bg-glass rounded-full border border-border min-w-[150px]"
    >
        <div class="flex flex-col items-center justify-center shrink-0 w-7">
            <span id="vol-display" class="text-[9px] font-mono font-black text-accent leading-none"
                >0</span
            >
            <span
                class="text-[6px] text-text-muted/40 font-black tracking-widest leading-none mt-0.5 uppercase"
                >Vol</span
            >
        </div>
        <button
            id="vol-dn"
            class="text-text-muted/40 hover:text-accent transition-colors text-xs font-bold px-1"
            >－</button
        >
        <input
            type="range"
            id="filter-volume"
            min="0"
            max="1000000"
            step="5000"
            value="0"
            class="w-12 lg:w-16 h-1 bg-glass-elevated rounded-full appearance-none cursor-pointer accent-accent"
        />
        <button
            id="vol-up"
            class="text-text-muted/40 hover:text-accent transition-colors text-xs font-bold px-1"
            >＋</button
        >
    </div>

    <!-- Watchlist -->
    <div class="relative h-8">
        <input type="checkbox" id="filter-starred" class="peer hidden" />
        <label
            for="filter-starred"
            class="flex items-center justify-center h-full px-3 lg:px-4 rounded-full border border-border bg-glass hover:bg-glass-hover cursor-pointer transition-all peer-checked:bg-accent/10 peer-checked:border-accent/40"
        >
            <span
                class="text-xs star-toggle-icon text-text-muted/40 group-hover:text-accent transition-colors"
                >☆</span
            >
            <span
                id="filtered-count"
                class="ml-1.5 text-[9px] font-mono font-black text-text-muted/50 whitespace-nowrap"
                >--</span
            >
        </label>
    </div>

    <!-- Reset Button -->
    <button
        id="live-filter-reset"
        title="重設所有篩選"
        class="flex items-center justify-center w-8 h-8 rounded-full border border-border bg-glass hover:bg-glass-hover hover:border-accent/30 text-text-muted/60 hover:text-accent transition-all shrink-0"
    >
        <svg
            class="w-3"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2.5"
            stroke-linecap="round"
            stroke-linejoin="round"
        >
            <path d="M3 6h18m-2 0v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6m3 0V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"
            ></path>
        </svg>
    </button>
</div>

<style>
    /* Custom range input styling */
    input[type='range']::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 10px;
        height: 10px;
        background: var(--color-accent);
        border-radius: 50%;
        cursor: pointer;
        border: 1.5px solid white;
        box-shadow: 0 0 8px var(--color-accent-glow);
    }

    input[type='range']::-moz-range-thumb {
        width: 10px;
        height: 10px;
        background: var(--color-accent);
        border-radius: 50%;
        cursor: pointer;
        border: 1.5px solid white;
    }
</style>

<script src="../../scripts/live-filter-engine.ts"></script>
