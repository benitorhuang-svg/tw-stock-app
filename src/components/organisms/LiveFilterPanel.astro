---
// src/components/organisms/LiveFilterPanel.astro
---

<div class="flex items-center gap-2 shrink-0">
    <!-- Search Section - Compact -->
    <div class="relative w-[140px]">
        <div
            class="absolute inset-y-0 left-2.5 flex items-center pointer-events-none text-text-muted/40"
        >
            <svg
                class="w-3.5 h-3.5"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="3"
                stroke-linecap="round"
                stroke-linejoin="round"
            >
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.3-4.3"></path>
            </svg>
        </div>
        <input
            type="text"
            id="live-search-input"
            placeholder="代號/名稱..."
            class="w-full h-8 pl-8 pr-2 bg-white/5 border border-white/5 focus:border-accent/40 rounded-lg text-[11px] font-bold placeholder:text-text-muted/30 transition-all outline-none"
        />
    </div>

    <!-- Filter Group - Compact -->
    <div class="flex items-center gap-1 p-0.5 bg-white/5 rounded-lg border border-white/5">
        <!-- Sector -->
        <select
            id="filter-sector"
            class="appearance-none h-7 px-2 pr-1 bg-transparent text-[10px] font-black tracking-tight text-text-primary/70 cursor-pointer outline-none hover:text-accent rounded-md transition-all uppercase min-w-[70px]"
        >
            <option value="">所有產業</option>
            <option value="semiconductor">半導體</option>
            <option value="electronics">電子</option>
            <option value="computer">電腦</option>
            <option value="finance">金融</option>
            <option value="shipping">航運</option>
            <option value="etf">ETF</option>
        </select>

        <div class="w-px h-3 bg-white/10"></div>

        <!-- Trend -->
        <select
            id="filter-trend"
            class="appearance-none h-7 px-2 bg-transparent text-[10px] font-black tracking-tight text-text-primary/70 cursor-pointer outline-none hover:text-accent rounded-md transition-all uppercase min-w-[70px]"
        >
            <option value="">不限趨勢</option>
            <option value="limit-up">漲停</option>
            <option value="up">上漲</option>
            <option value="flat">平盤</option>
            <option value="down">下跌</option>
            <option value="limit-down">跌停</option>
        </select>
    </div>

    <!-- Volume Range - Compact -->
    <div
        class="flex items-center gap-2 px-2 h-8 bg-white/5 rounded-lg border border-white/5 w-[130px]"
    >
        <span id="vol-display" class="text-[10px] font-mono font-black text-accent w-7 text-center"
            >0</span
        >
        <input
            type="range"
            id="filter-volume"
            min="0"
            max="50000"
            step="1000"
            value="0"
            class="flex-1 h-1 bg-white/10 rounded-full appearance-none cursor-pointer accent-accent"
        />
    </div>

    <!-- Watchlist - Compact -->
    <div class="relative h-8">
        <input type="checkbox" id="filter-starred" class="peer hidden" />
        <label
            for="filter-starred"
            class="flex items-center gap-2 h-full px-3 rounded-lg border border-white/5 bg-white/5 hover:bg-white/10 cursor-pointer transition-all peer-checked:bg-accent/10 peer-checked:border-accent/40 group/starred"
        >
            <span
                class="text-xs star-toggle-icon text-text-muted/50 group-hover/starred:text-accent"
                >☆</span
            >
            <div
                id="filtered-count"
                class="px-1.5 py-0.5 rounded bg-white/5 text-white/30 text-[9px] font-black font-mono"
            >
                --
            </div>
        </label>
    </div>
</div>

<style>
    /* Custom range input styling */
    input[type='range']::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 10px;
        height: 10px;
        background: var(--color-accent);
        border-radius: 50%;
        cursor: pointer;
        border: 1.5px solid white;
    }
</style>

<script>
    function syncFilterStarredUI() {
        const checkbox = document.getElementById('filter-starred') as HTMLInputElement;
        const starIcon = document.querySelector('.star-toggle-icon');

        if (checkbox) {
            checkbox.addEventListener('change', () => {
                if (starIcon) {
                    starIcon.textContent = checkbox.checked ? '★' : '☆';
                }
            });
        }
    }

    document.addEventListener('astro:page-load', syncFilterStarredUI);
</script>
