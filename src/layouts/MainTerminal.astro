---
/**
 * MainTerminal.astro ‚Äî Quantum Terminal Shell (Top-Nav Edition)
 * The outermost layout for all pages.
 * Full-width viewport + top navigation bar (desktop) / bottom-nav (mobile)
 */
import { ClientRouter } from 'astro:transitions';
import BaseHead from './BaseHead.astro';
import DesktopNavTabs from '../components/molecules/DesktopNavTabs.astro';
import MobileNavTabs from '../components/molecules/MobileNavTabs.astro';

import '../styles/global.css';

interface Props {
    title: string;
    description?: string;
    /** If true, removes content padding (e.g. for chart-heavy pages) */
    fullWidth?: boolean;
}

const { title, description, fullWidth = false } = Astro.props;
---

<!doctype html>
<html lang="zh-TW" class="dark">
    <head>
        <BaseHead title={title} description={description} />
        <ClientRouter />
    </head>
    <body class="flex flex-col h-[100dvh] overflow-hidden bg-base text-text-primary">
        <!-- Skip to main content (accessibility) -->
        <a
            href="#main-workspace"
            class="sr-only focus:not-sr-only focus:absolute focus:top-2 focus:left-2 focus:z-[100] focus:bg-accent focus:text-white focus:px-4 focus:py-2 focus:rounded-md focus:text-sm focus:font-bold"
            >Ë∑≥Âà∞‰∏ªË¶ÅÂÖßÂÆπ</a
        >

        <!-- ‚ïê‚ïê‚ïê Top Navigation Bar ‚ïê‚ïê‚ïê -->
        <header
            class="top-nav-bar flex-shrink-0 z-50"
            id="top-header"
            transition:persist="top-header"
        >
            <div
                class="flex items-center justify-between h-16 px-4 lg:px-6 max-w-[1800px] mx-auto w-full"
            >
                <!-- Left: Brand + Nav Tabs -->
                <div class="flex items-center gap-1 lg:gap-2">
                    <!-- Brand -->
                    <a
                        href="/"
                        class="flex items-center gap-2 no-underline mr-4 lg:mr-6 flex-shrink-0 group"
                        data-astro-prefetch
                    >
                        <div class="flex items-baseline gap-1">
                            <span
                                class="font-mono text-base lg:text-lg font-extrabold tracking-tight text-text-primary"
                            >
                                TWStock
                            </span>
                        </div>
                    </a>

                    <!-- Consolidated Standalone Data Obs -->
                    <div class="hidden md:flex items-center gap-3 mr-3 lg:mr-5">
                        <!-- Data Observation (Extracted Standalone) -->
                        <a
                            href="/database"
                            class:list={[
                                'flex items-center gap-2 px-4 h-[32px] rounded-lg transition-all text-[11px] font-black tracking-[0.2em] uppercase border backdrop-blur-md group',
                                Astro.url.pathname === '/database'
                                    ? 'bg-accent/15 border-accent/40 text-accent shadow-[0_0_20px_rgba(var(--accent-rgb),0.15)] shadow-inner'
                                    : 'bg-glass border-border text-text-muted hover:text-text-primary hover:border-border-highlight hover:bg-glass-hover',
                            ]}
                            data-astro-prefetch
                        >
                            <span>Êï∏ÊìöËßÄÊ∏¨</span>
                        </a>
                    </div>

                    <!-- Desktop Navigation Tabs -->
                    <DesktopNavTabs />
                </div>

                <!-- Right: System Status -->
                <div class="flex items-center gap-3">
                    <slot name="header-actions" />
                    <!-- Theme toggle -->
                    <div class="flex items-center gap-2">
                        <button
                            id="theme-toggle"
                            class="flex items-center justify-center w-8 h-8 rounded-lg bg-glass border border-border hover:border-accent/30 text-text-muted hover:text-text-secondary transition-all cursor-pointer"
                            aria-label="ÂàáÊèõ‰∏ªÈ°å"
                        >
                            <span id="theme-icon">üåô</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Subtle bottom gradient line -->
            <div class="nav-glow-line"></div>
        </header>

        <!-- ‚ïê‚ïê‚ïê Main Workspace ‚ïê‚ïê‚ïê -->

        <main
            class:list={[
                'flex-1 overflow-y-auto overflow-x-hidden',
                fullWidth ? 'p-0' : 'p-4 lg:p-6',
            ]}
            id="main-workspace"
        >
            <div class:list={[fullWidth ? '' : 'max-w-[1400px] mx-auto w-full']}>
                <slot />
            </div>
        </main>

        <!-- ‚ïê‚ïê‚ïê Mobile Bottom Navigation ‚ïê‚ïê‚ïê -->
        <MobileNavTabs />

        <!-- ‚ïê‚ïê‚ïê Global Scripts ‚ïê‚ïê‚ïê -->
        <script src="../scripts/global-engine.ts"></script>
    </body>
</html>
