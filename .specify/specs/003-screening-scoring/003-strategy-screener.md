# 003 — 選股濾鏡與策略評分 (Strategy Screener)

> 模組 3：建立於模組 2 (Analytics Engine) 之上，負責整合基本面、技術面與籌碼面，提供高階的選股決策與預設情境。

## 職責定義

本層負責**綜合性選股策略與決策生成**：
1. **多面向篩選**：結合基本面、技術面、籌碼面進行深度篩選。
2. **策略範本**：提供預先定義好的選股策略（如：價值投資、成長動能、大戶籌碼等）。
3. **自訂篩選**：允許使用者自由組合三面指標進行動態查詢。
4. **決策與風險管理**：生成進出場訊號，並提供風險控制建議（止損、止盈、投資組合分散度）。

## 三大核心分析模組

### 1. 基本面分析 (Fundamental Analysis) - 決定「買什麼」
旨在找出具有成長潛力或價值被低估的公司。

| 指標 | 說明 | 條件範例 |
|------|------|----------|
| EPS (每股盈餘) | 衡量公司獲利能力 | 連續 3 季 > 0 且 YoY > 10% |
| ROE (股東權益報酬率) | 衡量自有資本獲利效率 | > 15% |
| 現金流量 | 營業現金流是否穩健 | 營業現金流 > 0 |
| PEG (本益成長比) | 評估股價是否被低估 (PE / EPS成長率) | < 1 (股價被低估) |
| 總體經濟與產業 | 觀察景氣、利率 (如聯準會動向)、AI 等產業週期 | (此屬質化分析，系統提供產業標籤與大盤資金流向) |

### 2. 技術面分析 (Technical Analysis) - 決定「何時買賣」
利用歷史價量數據預測未來趨勢，串接 Layer 6 提供之技術指標。

| 指標 | 說明 | 條件範例 |
|------|------|----------|
| 趨勢 MA (移動平均) | 判斷多空趨勢 | 股價站上季線 (MA60) 且均線多頭排列 |
| 強弱指標 (RSI, KD) | 判斷市場過熱或超賣 | RSI(14) 突破 50 或 KD 在 20 以下黃金交叉 |
| 動能指標 (MACD) | 捕捉轉折與趨勢強度 | MACD 柱狀圖由負轉正 (或 DIF 上穿 MACD) |

### 3. 籌碼面分析 (Chip Analysis) - 確認「誰在買」
追蹤大資金與主力動向。

| 指標 | 說明 | 條件範例 |
|------|------|----------|
| 三大法人動向 | 外資、投信、自營商買賣超 | 投信連續 3 日買超 或 外資買超 > 1000 張 |
| 籌碼集中度 | 主力分點券商買進比例 | 1 日集中度 > 20% (大戶吃貨) |
| 內部人持股 | 董監事與大股東持股增減 | 董監事持股連續 2 個月增加 |

## 綜合選股決策 (Decision Making)

系統提供**動態評分機制 (Scoring System)**：
對符合各面向的條件給予權重與評分。

**範例策略：2026 穩健成長波段策略**
- **S (篩選)**：基本面合規 (PEG < 1, ROE > 15)
- **C (籌碼)**：籌碼集中 (近 5 日主力買超 > 20%)
- **T (技術)**：技術發動 (MACD 剛黃金交叉，股價站上 MA20)
- **Action**: 當 S + C + T 均成立時，觸發「強烈進場訊號」。

## 風險管理 (Risk Management)

| 項目 | 說明與系統實作 |
|------|----------------|
| 止損點 (Stop Loss) | 月線 (MA20) 跌破 或 建倉成本下跌 8-10% 時自動跳出警示 |
| 止盈點 (Take Profit) | RSI > 80 (超買) 或 獲利達 20% 時啟動移動停利機制 |
| 分散投資 (Diversification) | 檢查目前的投資組合 (Portfolio) 中各產業持股比例，避免單一產業 (如純 AI) 佔比超過上限 |

## 系統架構變更需求

實作此自動化選股篩選器，需連動以下架構調整：
- **Layer 1 (Data Sources)**: 新增爬取三大法人、籌碼集中度、財務報表 (EPS, 現金流) 的腳本。
- **Layer 2 (Data Build)**: 擴建資料庫 Schema，匯入籌碼與進階財務資料。
- **Layer 3 (Storage)**: 新增 `chips`, `financials` 關聯表查詢。
- **Layer 6 (Analysis Engine)**: 擴增 PEG 計算、籌碼集中度計算等純函式。

## 待辦任務
- [ ] **T9-01**: 定義 `ScreenerStrategy` TypeScript 介面，支援多面向條件組合。
- [ ] **T9-02**: 實作 `evaluateStrategy(stockSymbol, strategy)` 評分引擎。
- [ ] **T9-03**: 建立首批 3 個預設綜合選股策略範本。
